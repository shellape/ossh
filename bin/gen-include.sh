#!/bin/bash
# name:          gen-include.sh
# description:   Generate the ossh include config from ossh's default values.
# author:        vd@ghostshell.de
# version:       0.1
# tested on:     Debian Jessie
# vim: ts=3 sw=3 sts=3 et ai ci
set -e

PROG_NAME="${0##*/}"
ARGV="$@"
SCRIPT_CWD=$( cd ${0%/*} 2> /dev/null; pwd )
OSSH_BIN=ossh
OSSH_INCLUDE_CONF='~/.ossh_include.conf'
USAGE="\
Write include config file to stdout (using defaults of $OSSH_BIN).

Usage: $PROG_NAME -w

Optionally write it to the include config (e.g. $OSSH_INCLUDE_CONF)\n\n"


if [[ $1 =~ -h|--help|help ]] || [[ $1 != -w ]]; then
   printf "$USAGE"
   exit 1
fi

cd $SCRIPT_CWD
printf "# Generated by $PROG_NAME\n\n"
while read line; do
   [[ $line == \#\</USER_CONFIG\> ]] && exit
   if [[ $line == \#\<USER_CONFIG\> ]]; then
      config_start=yes
      continue
   fi
   [[ $config_start == yes ]] && echo "$line"
done < $OSSH_BIN
